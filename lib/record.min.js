"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},check=function(e){return e&&e.Math==Math&&e},global_1=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof commonjsGlobal&&commonjsGlobal)||Function("return this")(),fails=function(e){try{return!!e()}catch(e){return!0}},descriptors=!fails(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),nativePropertyIsEnumerable={}.propertyIsEnumerable,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor&&!nativePropertyIsEnumerable.call({1:2},1),f=NASHORN_BUG?function(e){var t=getOwnPropertyDescriptor(this,e);return!!t&&t.enumerable}:nativePropertyIsEnumerable,objectPropertyIsEnumerable={f:f},createPropertyDescriptor=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},toString={}.toString,classofRaw=function(e){return toString.call(e).slice(8,-1)},split="".split,indexedObject=fails(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==classofRaw(e)?split.call(e,""):Object(e)}:Object,requireObjectCoercible=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},toIndexedObject=function(e){return indexedObject(requireObjectCoercible(e))},isObject=function(e){return"object"==typeof e?null!==e:"function"==typeof e},toPrimitive=function(e,t){if(!isObject(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!isObject(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!isObject(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!isObject(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},hasOwnProperty={}.hasOwnProperty,has=function(e,t){return hasOwnProperty.call(e,t)},document$1=global_1.document,EXISTS=isObject(document$1)&&isObject(document$1.createElement),documentCreateElement=function(e){return EXISTS?document$1.createElement(e):{}},ie8DomDefine=!descriptors&&!fails(function(){return 7!=Object.defineProperty(documentCreateElement("div"),"a",{get:function(){return 7}}).a}),nativeGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,f$1=descriptors?nativeGetOwnPropertyDescriptor:function(e,t){if(e=toIndexedObject(e),t=toPrimitive(t,!0),ie8DomDefine)try{return nativeGetOwnPropertyDescriptor(e,t)}catch(e){}if(has(e,t))return createPropertyDescriptor(!objectPropertyIsEnumerable.f.call(e,t),e[t])},objectGetOwnPropertyDescriptor={f:f$1},replacement=/#|\.prototype\./,isForced=function(e,t){var r=data[normalize(e)];return r==POLYFILL||r!=NATIVE&&("function"==typeof t?fails(t):!!t)},normalize=isForced.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced.data={},NATIVE=isForced.NATIVE="N",POLYFILL=isForced.POLYFILL="P",isForced_1=isForced,path={},aFunction=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},functionBindContext=function(n,o,e){if(aFunction(n),void 0===o)return n;switch(e){case 0:return function(){return n.call(o)};case 1:return function(e){return n.call(o,e)};case 2:return function(e,t){return n.call(o,e,t)};case 3:return function(e,t,r){return n.call(o,e,t,r)}}return function(){return n.apply(o,arguments)}},anObject=function(e){if(!isObject(e))throw TypeError(String(e)+" is not an object");return e},nativeDefineProperty=Object.defineProperty,f$2=descriptors?nativeDefineProperty:function(e,t,r){if(anObject(e),t=toPrimitive(t,!0),anObject(r),ie8DomDefine)try{return nativeDefineProperty(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e},objectDefineProperty={f:f$2},createNonEnumerableProperty=descriptors?function(e,t,r){return objectDefineProperty.f(e,t,createPropertyDescriptor(1,r))}:function(e,t,r){return e[t]=r,e},getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,wrapConstructor=function(n){function e(e,t,r){if(this instanceof n){switch(arguments.length){case 0:return new n;case 1:return new n(e);case 2:return new n(e,t)}return new n(e,t,r)}return n.apply(this,arguments)}return e.prototype=n.prototype,e},_export=function(e,t){var r,n,o,i,c,a,u,l,p=e.target,s=e.global,f=e.stat,d=e.proto,y=s?global_1:f?global_1[p]:(global_1[p]||{}).prototype,b=s?path:path[p]||(path[p]={}),m=b.prototype;for(o in t)r=!isForced_1(s?o:p+(f?".":"#")+o,e.forced)&&y&&has(y,o),c=b[o],r&&(a=e.noTargetGet?(l=getOwnPropertyDescriptor$1(y,o))&&l.value:y[o]),i=r&&a?a:t[o],r&&typeof c==typeof i||(u=e.bind&&r?functionBindContext(i,global_1):e.wrap&&r?wrapConstructor(i):d&&"function"==typeof i?functionBindContext(Function.call,i):i,(e.sham||i&&i.sham||c&&c.sham)&&createNonEnumerableProperty(u,"sham",!0),b[o]=u,d&&(has(path,n=p+"Prototype")||createNonEnumerableProperty(path,n,{}),path[n][o]=i,e.real&&m&&!m[o]&&createNonEnumerableProperty(m,o,i)))},aFunction$1=function(e){return"function"==typeof e?e:void 0},getBuiltIn=function(e,t){return arguments.length<2?aFunction$1(path[e])||aFunction$1(global_1[e]):path[e]&&path[e][t]||global_1[e]&&global_1[e][t]},engineUserAgent=getBuiltIn("navigator","userAgent")||"",slice=[].slice,MSIE=/MSIE .\./.test(engineUserAgent),wrap=function(o){return function(e,t){var r=2<arguments.length,n=r?slice.call(arguments,2):void 0;return o(r?function(){("function"==typeof e?e:Function(e)).apply(this,n)}:e,t)}};_export({global:!0,bind:!0,forced:MSIE},{setTimeout:wrap(global_1.setTimeout),setInterval:wrap(global_1.setInterval)});var setInterval=path.setInterval,setInterval$1=setInterval,setInterval$2=setInterval;function RTCRecord(e,t){var r,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=null,i=n.collectTime||1e3,c={mimeType:"video/webm;codecs=vp9"},a=null;function u(e){e.data&&0<e.data.size&&t&&t(e.data)}return o=e,r={mimeType:"video/webm;codecs=vp9"},MediaRecorder.isTypeSupported(r.mimeType)||(console.error("".concat(r.mimeType," is not Supported")),r={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(r.mimeType)||(console.error("".concat(r.mimeType," is not Supported")),r={mimeType:"video/webm"},MediaRecorder.isTypeSupported(r.mimeType)||(console.error("".concat(r.mimeType," is not Supported")),r={mimeType:""}))),c=r,function(){try{a=new MediaRecorder(o,c)}catch(e){return console.error("Exception while creating MediaRecorder:",e)}a.onstop=function(e){a=null,n.ended&&n.ended()},a.ondataavailable=u,a.start(i)}(),e.onended=function(){e=o=null},a}function CanvasRecord(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=null,o=e.videoHeight||e.clientHeight,i=e.videoWidth||e.clientWidth,c={ondataavailable:function(){},onstop:function(){},stop:s,start:function(){e.play()}};e.addEventListener("canplay",l,!1),e.addEventListener("ended",p,!1);var a=document.createElement("canvas");function u(){var t=a.getContext("2d");t.drawImage(e,0,0,o,i),a.toBlob(function(e){c.ondataavailable(e,t)},"image/webp")}function l(){u(),n=setInterval$2(function(){u()},r.duration||200)}function p(){s(),c.onstop(),console.log("视频录制结束!")}function s(){n&&clearInterval(n),e.removeEventListener("canplay",l,!1),e.removeEventListener("ended",p,!1),a=null}return a.style.display="none",a.setAttribute("height",o),a.setAttribute("width",i),c}function record(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return"undefined"!=typeof MediaRecorder?RTCRecord(e,r,n):CanvasRecord(t,r,n)}exports.CanvasRecord=CanvasRecord,exports.RTCRecord=RTCRecord,exports.default=record;
