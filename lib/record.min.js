"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var _setInterval=_interopDefault(require("@babel/runtime-corejs3/core-js-stable/set-interval")),_Promise=_interopDefault(require("@babel/runtime-corejs3/core-js-stable/promise"));function RTCRecord(e,t){var n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=null,i=o.collectTime||1e3,d={mimeType:"video/webm;codecs=vp9"},c=null;function a(e){e.data&&0<e.data.size&&t&&t(e.data)}return r=e,n={mimeType:"video/webm;codecs=vp9"},MediaRecorder.isTypeSupported(n.mimeType)||(console.error("".concat(n.mimeType," is not Supported")),n={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(n.mimeType)||(console.error("".concat(n.mimeType," is not Supported")),n={mimeType:"video/webm"},MediaRecorder.isTypeSupported(n.mimeType)||(console.error("".concat(n.mimeType," is not Supported")),n={mimeType:""}))),d=n,function(){try{c=new MediaRecorder(r,d)}catch(e){return console.error("Exception while creating MediaRecorder:",e)}c.onstop=function(e){c=null,o.ended&&o.ended()},c.ondataavailable=a,c.start(i)}(),e.onended=function(){e=r=null},c}function CanvasRecord(i,d){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a=null,t=null,e=new _Promise(function(e){return t=e});function u(){return i.videoHeight||i.clientHeight}function s(){return i.videoWidth||i.clientWidth}function n(){var e,t=((e=document.createElement("canvas")).style.display="none",e.setAttribute("height",u()),e.setAttribute("width",s()),document.body.append(e),e),n=t.getContext("2d"),o=u(),r=s();a=_setInterval(function(){n.drawImage(i,0,0,o,r),t.toBlob(function(e){d&&d(e)},"image/webp")},c.duration||200)}function o(){r(),t(),console.log("视频播放完毕！")}function r(){a&&clearInterval(a),i.removeEventListener("canplay",n,!1),i.removeEventListener("ended",o,!1),c.ended&&c.ended()}return i.addEventListener("canplay",n,!1),i.addEventListener("ended",o,!1),{stop:r,canvasRecordPromise:e}}function record(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return"undefined"!=typeof MediaRecorder?RTCRecord(e,n,o):CanvasRecord(t,n,o)}exports.CanvasRecord=CanvasRecord,exports.RTCRecord=RTCRecord,exports.default=record;
